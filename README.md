# MySQL ThingsDB Module (Go)

MySQL module written using the [Go language](https://golang.org). This module can be used to communicate with MySQL

## Installation

Install the module by running the following command in the `@thingsdb` scope:

```javascript
new_module('mysql', 'github.com/thingsdb/module-go-mysql');
```

Optionally, you can choose a specific version by adding a `@` followed with the release tag. For example: `@v0.1.0`.

## Configuration

The MySQL module requires a configuration with the following properties:

Property           | Type                              | Description
-------------------| --------------------------------- | -----------
dsn               | str (required)                    | Data source name; DSN format: `username:password@protocol(address)/dbname?param=value`
conn_max_lifetime  | int (time unit: minute; optional) | Maximum amount of time a connection may be reused.
max_idle_conn      | int (optional)                    | Maximum number of connections in the idle connection pool.
max_open_conn      | int (optional)                    | Maximum number of open connections to the database.
max_idle_time_conn | int (time unit: minute; optional) | Maximum amount of time a connection may be idle.

Example configuration:

```javascript
set_module_conf('siridb', {
    dsn: "username:password@/dbname",
    conn_max_lifetime: 3,
    max_idle_conn: 10,
    max_open_conn: 1
});
```

## Exposed functions

Name              | Description
----------------- | -----------
[query](#query)   | Run a GCD query.

### Query

#### Arguments

 Argument     | Type                                                  | Description
------------- | ----------------------------------------------------- | -----------
`query`       | `string` (required, except when `fetch` is `DbStats`) | Query string or template query string with `?`.
`params`      | `array` (optional)                                    | The values that need to be inserted in the query at `?`.
`fetch`       | `string` (optional)                                   | The way the result will be returned, options are: `Columns`, `Rows`, `DbStats`, `LastInsertId` or `RowsAffected`.
`transaction` | `boolean` (optional)                                  | Indicates if the query needs to be wrapped in transaction statements or not.
`timeout`     | `integer` (optional)                                  | Provide a custom timeout in seconds (Default: 10 seconds).

#### Example:

```javascript
mysql.query(
    'SELECT * FROM pet WHERE species = ?;',
    ['dog'],
    "Rows",
    false,
    30
}).then(|res| {
    res; // just return the response.
});
```

#### Fetch types

#### Columns

Returns a map containing the column names and corresponding column types.

#### Rows

Returns a array with maps containing the column names and corresponding values.

#### Stats

Returns the following database statistics:

* Idle: the number of idle connections.
* InUse: the number of connections currently in use.
* MaxIdleClosed: the total number of connections closed due to SetMaxIdleConns.
* MaxIdleTimeClosed: the total number of connections closed due to SetConnMaxIdleTime.
* MaxLifetimeClosed: the total number of connections closed due to SetConnMaxLifetime.
* MaxOpenConnections: maximum number of open connections to the database.
* OpenConnections: the number of established connections both in use and idle.
* WaitCount: the total number of connections waited for.
* WaitDuration: the total time blocked waiting for a new connection.

#### LastInsertId

Returns the integer generated by the database in response to a command. Typically this will be from an "auto increment" column when inserting a new row.

#### RowsAffected

Returns the number of rows affected by an update, insert, or delete.
